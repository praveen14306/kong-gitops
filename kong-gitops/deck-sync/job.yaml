apiVersion: batch/v1
kind: Job
metadata:
  name: deck-sync
spec:
  template:
    spec:
      containers:
      - name: deck
        image: kong/deck:latest
        command:
          - /bin/sh
          - -c
          - |
            deck gateway ping --kong-addr http://localhost:8001/ && \
            deck gateway sync --state /config/kong.yaml --kong-addr http://localhost:8001/
        volumeMounts:
        - name: config
          mountPath: /config
      restartPolicy: Never
      volumes:
      - name: config
        configMap:
          name: deck-config
  backoffLimit: 3

